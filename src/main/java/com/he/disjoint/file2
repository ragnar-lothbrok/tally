SELECT rg.id AS id,
       rg.name AS name,
       rg.description AS description,
       length(replace(temp.users,',','')) AS userCount,
       length(replace(temp.resources,',','')) AS resourcesCount
FROM resourcegroup rg
JOIN
  (SELECT resourcegroup_id,
          GROUP_CONCAT(if(resource_type_id=#{userResourceTypeId},'#','')) AS users,
          GROUP_CONCAT(if(resource_type_id > #{roleResourceTypeId},'#','')) AS resources
   FROM resourcegroup_resource
   WHERE resourcegroup_id =#{resourceGroupId}
     OR resourcegroup_id IN
       (SELECT rr1.resource_id
        FROM resourcegroup_resource rr1
        WHERE rr1.resourcegroup_id=#{resourceGroupId}
          AND rr1.resource_type_id=#{resourceGroupTypeId})
   GROUP BY resourcegroup_id) temp ON rg.id=temp.resourcegroup_id;